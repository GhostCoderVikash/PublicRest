<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Call to Salesforce (Public)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
    </style>
</head>
<body>
    <h1>API Call to Salesforce (Public)</h1>

    <script>
        window.onload = function() {
            fetchApiData();
        };

        async function fetchApiData() {
            const apiEndpoint = `https://resourceful-fox-a2o4pb-dev-ed.trailblaze.my.site.com/services/apexrest/miawSiteConfigAPI?url=https://ghostcodervikash.github.io/demo`;

            // Log the initial API endpoint
            console.log("Calling API with endpoint:", apiEndpoint);

            try {
                // Making the GET request to the Salesforce API
                const response = await fetch(apiEndpoint, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/xml' // Expecting XML response
                    }
                });

                // Log the response status
                console.log("Response Status:", response.status);

                if (!response.ok) {
                    throw new Error('Failed to fetch data');
                }

                // Get the response text (XML format)
                const responseText = await response.text();
                console.log("Response Text:", responseText); // Log the full XML response

                // Parse the XML response
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(responseText, "application/xml");

                // Log the parsed XML structure
                console.log("Parsed XML:", xmlDoc);

                // Extract the data, handling the namespace correctly
                const ns = "http://soap.sforce.com/schemas/class/MiawSiteConfigAPI"; // Define the namespace
                const URL = xmlDoc.getElementsByTagNameNS(ns, "ConfigResponse:URL");
                const message = xmlDoc.getElementsByTagNameNS(ns, "ConfigResponse:message");
                const Language = xmlDoc.getElementsByTagNameNS(ns, "ConfigResponse:Language");
                const BusinessStartTime = xmlDoc.getElementsByTagNameNS(ns, "ConfigResponse:Business_Start_Time");
                const BusinessEndTime = xmlDoc.getElementsByTagNameNS(ns, "ConfigResponse:Business_End_Time");

                // Check if each element exists before accessing textContent
                if (URL.length > 0) {
                    console.log("URL:", URL[0].textContent);
                } else {
                    console.log("ConfigResponse:URL tag not found");
                }

                if (message.length > 0) {
                    console.log("Message:", message[0].textContent);
                } else {
                    console.log("ConfigResponse:message tag not found");
                }

                if (Language.length > 0) {
                    console.log("Language:", Language[0].textContent);
                } else {
                    console.log("ConfigResponse:Language tag not found");
                }

                if (BusinessStartTime.length > 0) {
                    console.log("Business Start Time:", BusinessStartTime[0].textContent);
                } else {
                    console.log("ConfigResponse:Business_Start_Time tag not found");
                }

                if (BusinessEndTime.length > 0) {
                    console.log("Business End Time:", BusinessEndTime[0].textContent);
                } else {
                    console.log("ConfigResponse:Business_End_Time tag not found");
                }

            } catch (error) {
                // Log the error
                console.log("Error:", error.message);
            }
        }
    </script>
</body>
</html>
